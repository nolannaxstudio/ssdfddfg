<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Backrooms Admin Panel</title>
<style>
body{background:#111;color:white;font-family:Arial;padding:20px;}
#loginBox, #adminPanel{max-width:400px;margin:50px auto;padding:20px;background:#222;border-radius:10px;}
input, button{width:100%;padding:10px;margin-top:10px;border-radius:5px;border:none;}
button{background:#00ccff;cursor:pointer;font-weight:bold;}
button:hover{background:#0099cc;}
#logs{background:black;padding:10px;height:200px;overflow-y:auto;margin-top:15px;}
.logItem{border-bottom:1px solid #333;padding:3px;font-size:14px;}
</style>
</head>
<body>

<div id="loginBox">
<h2>üîê Admin Login</h2>
<input type="text" id="username" placeholder="Nom d'utilisateur">
<input type="password" id="code" placeholder="Code admin">
<button onclick="login()">Se connecter</button>
<p id="msg" style="color:red;text-align:center;"></p>
</div>

<div id="adminPanel" style="display:none;">
<h2>Admin : <span id="userDisplay"></span></h2>
<h3>Commandes /music</h3>
<textarea readonly>/music 1234
/music 5678
/music 9101112</textarea>

<h3>üìù Logs</h3>
<div id="logs"></div>

<h3>üë• Utilisateurs connect√©s</h3>
<ul id="userList"></ul>

<button onclick="logout()">Se d√©connecter</button>
</div>

<script>
async function login(){
  const user = document.getElementById('username').value.trim();
  const code = document.getElementById('code').value.trim();
  if(!user){document.getElementById('msg').textContent="Entre un pseudo"; return;}

  const res = await fetch('/.netlify/functions/login', {
    method:'POST',
    body: JSON.stringify({ user, code })
  });
  const data = await res.json();

  if(data.success){
    document.getElementById('loginBox').style.display='none';
    document.getElementById('adminPanel').style.display='block';
    document.getElementById('userDisplay').textContent = user;
    updateUsers();
    addLog(user+" connect√©");
  } else {
    document.getElementById('msg').textContent="‚ùå Mauvais code";
  }
}

async function addLog(msg){
  const user = document.getElementById('userDisplay').textContent;
  await fetch('/.netlify/functions/logs', {
    method:'POST',
    body: JSON.stringify({ user, message: msg })
  });
  showLogs();
}

async function showLogs(){
  const res = await fetch('/.netlify/functions/logs');
  const data = await res.json();
  const logsDiv = document.getElementById('logs');
  logsDiv.innerHTML = '';
  data.forEach(l=>{
    const div=document.createElement('div');
    div.className='logItem';
    div.textContent=`[${l.time}] ${l.user} : ${l.message}`;
    logsDiv.appendChild(div);
  });
}

async function updateUsers(){
  const res = await fetch('/.netlify/functions/login');
  const data = await res.json();
  const ul = document.getElementById('userList');
  ul.innerHTML='';
  data.users.forEach(u=>{
    const li=document.createElement('li'); li.textContent=u; ul.appendChild(li);
  });
}

function logout(){
  const user = document.getElementById('userDisplay').textContent;
  addLog(user+" s'est d√©connect√©");
  document.getElementById('adminPanel').style.display='none';
  document.getElementById('loginBox').style.display='block';
}
</script>
</body>
</html>
